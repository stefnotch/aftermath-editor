<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <title>Mathml Editor</title>
  <style></style>
</head>
<body>
  <div style="width: 15em">
    This mathematical formula with a big summation and the number pi
    <math display="block" style="font-family: STIX Two" tabindex="0">
      <mrow>
        <munderover>
          <mo>∑</mo>
          <mrow><mi>n</mi><mo>=</mo><mn>0</mn></mrow>
          <mrow><mo>+</mo><mn>∞</mn></mrow>
        </munderover>
        <mfrac>
          <mn>1</mn>
          <msup><mi>n</mi><mn>2</mn></msup>
        </mfrac>
      </mrow>
      <mo>=</mo>
      <mfrac>
        <msup><mi>π</mi><mn>2</mn></msup>
        <mn>6</mn>
      </mfrac>
    </math>
    is easy to prove. This is a test
    <math display="block" style="font-family: STIX Two" tabindex="0">
      <munderover>
        <mo>cat</mo>
        <mn>27</mn>
        <mn>∞</mn>
      </munderover>
      <mo>=</mo>
      <mo>&lt;</mo>
      <mo>&gt;</mo>
      <mo>=</mo>
      <munderover>
        <mo>cat</mo>
        <mn>27</mn>
        <mn>∞</mn>
      </munderover>
    </math>

    An annotated test case.
    <br />
    One approach is to only place the caret at new-edges. All other edges get
    skipped. (And certain elements get ignored.) Alrighty, this works. Now we
    just need to fix the caret (position and size). ^ was trash

    <math>
      <!--|-->
      <mfrac>
        <!--|--><msqrt>
          <mi> <!--|-->π<!--|--> </mi>
        </msqrt>
        <!--|-->
        <mn> <!--|-->6<!--|--> </mn>
      </mfrac>
      <!--|-->
      <mo>+</mo>
      <!--|-->
      <mfrac>
        <mi> <!--|-->π<!--|--> </mi>
        <mn> <!--|-->6<!--|--> </mn>
      </mfrac>
      <!--|-->
      <mo>+</mo>
      <!--|-->
      <msqrt>
        <!--|-->
        <msqrt>
          <mn> <!--|-->5<!--|--> </mn>
        </msqrt>
        <!--|-->
      </msqrt>
      <!--|-->
      <mo>+</mo>
      <!--|-->
      <mo>+</mo>
      <!--|-->
      <munderover>
        <mo> <!--|-->c<!--|--> </mo>
        <mn> <!--|-->2<!--|-->7<!--|--> </mn>
        <mn> <!--|-->∞<!--|--> </mn>
      </munderover>
      <!--|-->
    </math>
    <br />
    Another approach is to start with the simplest elements, define rules for
    them and then carefully add in more complicated ones.
    <h4>mi</h4>
    Cursor can be placed at the beginning and end. Cursor can also be placed in
    the text.
    <h4>multiple mi</h4>
    Cursor can be placed between them. If this happens, the cursor will skip
    edges that are touching each other. (if at edge and we're moving, skip over
    all touching edges)
    <h4>mn,mo,ms</h4>
    same as mi
    <h4>mfrac</h4>
    Cursor can be placed at the beginning and end. Same rules as mi, including
    the multiple mi rule. The inside of a fraction has strict delimiters. Across
    those, the "edge touching" rule will be disabled. Like this:
    frac|top|bottom|frac
    <h4>mtext</h4>
    Cursor can be placed at the beginning and end. Same rules as mi, including
    the multiple mi rule. The inside of mtext has strict delimiters. They block
    the "mi-edge touching"
    <h4>math</h4>
    like mtext, except with the special case that we cannot navigate out of it.
    ever.
    <h4>msqrt</h4>
    like mtext
    <h4>mroot</h4>
    Cursor can be placed at the beginning and end. Same rules as mi, including
    the multiple mi rule. The inside of it has strict delimiters for only the
    second element! Like this: mroot msqrt msqrt | nthroot | mroot
    <h4>mpadded</h4>
    like mtext, I guess? unless I find out that people use mpadded for fun
    <h4>msub</h4>
    like mroot. strict delimiters only around the second element
    <h4>msub, msup, msubsup</h4>
    like mroot. strict delimiters only around the second element
    <h4>munder, mover, munderover</h4>
    like mfrac, strict delimiters everywhere inside it
    <h4>mtd</h4>
    like mtext
    <h4>mtr</h4>
    skippy skip
    <br />
    However, all those rules are doomed to fail.
    <code>\frac{\sqrt{}}{}</code> says henlo
  </div>
  <script src="./helpers.js"></script>
  <script src="./script.js"></script>
</body>
